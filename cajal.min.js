/**
 * cajal is a javascript library for drawing and animating pixelgrahics
 * on the canvas element as specified in the html5 standard.
 * Being completely object orientated you can draw the same item objects an animations
 * to several cajal instances, each linked with a different canvas element.
 *
 *
 * @author Robert Fleischmann
 * @version 1.0.1
 */
(function(){var e=this.cajal=function(a,b){this.init(a,b)};e.extend=function(){var a=arguments[0]||{},b=1,c=arguments.length,d=false,f,g,j,h;if(typeof a==="boolean"){d=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!e.isFunction(a))a={};if(c===b){a=this;--b}for(;b<c;b++)if((f=arguments[b])!==null)for(g in f){j=a[g];h=f[g];if(a!==h)if(d&&h&&(e.isPlainObject(h)||e.isArray(h))){j=j&&(e.isPlainObject(j)||e.isArray(j))?j:e.isArray(h)?[]:{};a[g]=e.extend(d,j,h)}else if(h!==undefined)a[g]=h}return a};
e.extend({isEmptyObject:function(a){for(var b in a)return false;return true},isFunction:function(a){return Object.prototype.toString.call(a)==="[object Function]"},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||Object.prototype.toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!Object.prototype.hasOwnProperty.call(a,"constructor")&&!Object.prototype.hasOwnProperty.call(a.constructor.prototype,
"isPrototypeOf"))return false;for(var b in a);return b===undefined||Object.prototype.hasOwnProperty.call(a,b)},uniqid:function(){for(var a="",b=0;b<32;b++)a+="0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ".substr(Math.floor(Math.random()*62),1);return a}});var n={autoClearCanvas:true,globalAlpha:1,globalCompositeOperation:"source-over",loopFps:30};e.extend(e.prototype,{init:function(a,b){this.canvas=typeof a==="string"?document.getElementById(a):a;this.ctx=this.canvas.getContext("2d");
this.items=[];this.loopAnimations=[];this.loopAnimationFrames=[];this.loopFrame=0;this.options=e.extend({},n,b);this.isEmpty=true;this.clear()},add:function(){if(typeof arguments[0]==="object"&&arguments.length===1)this.items.push({item:arguments[0]});else if(typeof arguments[1]==="object"&&arguments.length===2){var a=""+arguments[0];this.get(a)&&this.remove(a);this.items.push({itemId:a,item:arguments[1]})}return this},get:function(a){for(i in this.items)if(this.items[i].itemId===a)return this.items[i].item;
return false},remove:function(a){a=this.index(a);if(false!==a){var b=this.items.slice(a+1);this.items.length=a;this.items.push.apply(this.items,b);return this}return false},index:function(a){for(i in this.items)if(this.items[i].itemId===a)return parseInt(i);return false},up:function(a){var b;if((b=this.index(a))!==false){var c=this.items[b++];this.deleteItem(a);this.items.splice(b,0,c);return this}return false},down:function(a){var b;if((b=this.index(a))!==false){var c=this.items[b--];this.deleteItem(a);
this.items.splice(b,0,c);return this}return false},top:function(a){if(this.index(a)!==false){var b=this.get(a);this.deleteItem(a).add(a,b);return this}return false},bottom:function(a){var b;if((b=this.index(a))!==false){b=this.items[b];this.deleteItem(a);this.items.splice(0,0,b);return this}return false},draw:function(a){this.isEmpty===false&&this.options.autoClearCanvas===true&&this.clear();this.isEmpty=false;for(i in this.items)this.items[i].item.draw(this,a);return this},clear:function(){this.ctx.clearRect(0,
0,this.canvas.width,this.canvas.height);this.isEmpty=true;return this},animate:function(a,b){this.loopAddAnimation(a,b);return this},stop:function(a){if(a===true)this.loopAnimations=[];for(i in this.loopAnimations)if(this.loopAnimations[i].callback===a)if(this.loopAnimations.length===1)this.loopAnimations=[];else delete this.loopAnimations[i];if(this.loopAnimations.length===0){clearInterval(this.loopInterval);this.loopInterval=null}return this},loopInterval:null,loopAnimationExists:function(a){for(i in this.loopAnimations)if(this.loopAnimations[i].callback===
a)return true;return false},loopAddAnimation:function(a,b){if(!this.loopAnimationExists(a)){this.loopAnimations.push({callback:a,duration:b||-1,frame:0});if(this.loopInterval===null){var c=this;this.loopInterval=setInterval(function(){c.loop()},Math.round(1E3/this.options.loopFps))}}},loop:function(){this.loopFrame++;for(i in this.loopAnimations){var a=this.loopAnimations[i];a.frame++;if(a.duration>0&&a.frame>a.duration)delete this.loopAnimations[i];else a.callback.apply(this,[a.frame,a.duration])}this.draw();
if(this.loopAnimations.length===0){clearInterval(this.loopInterval);this.loopInterval=null}}});e.LinearGradient=function(a,b,c,d){this.properties={start:{x:a,y:b},end:{x:c,y:d},colorStops:[]};return this};e.extend(e.LinearGradient.prototype,{colorStop:function(a,b){this.properties.colorStops.push({pos:a,color:b});return this},draw:function(a){a=a.createLinearGradient(this.properties.start.x,this.properties.start.y,this.properties.end.x,this.properties.end.y);for(i in this.properties.colorStops)a.addColorStop(this.properties.colorStops[i].pos,
this.properties.colorStops[i].color);return a}});e.RadialGradient=function(a,b,c,d,f,g){this.properties={start:{x:a,y:b,r:c},end:{x:d,y:f,r:g},colorStops:[]};return this};e.extend(e.RadialGradient.prototype,{colorStop:function(a,b){this.properties.colorStops.push({pos:a,color:b});return this},draw:function(a){a=a.createRadialGradient(this.properties.start.x,this.properties.start.y,this.properties.start.r,this.properties.end.x,this.properties.end.y,this.properties.end.r);for(i in this.properties.colorStops)a.addColorStop(this.properties.colorStops[i].pos,
this.properties.colorStops[i].color);return a}});var k={stroke:null,fill:null,width:1,font:"13px sans-serif",textAlign:"left",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowX:0,shadowY:0,shadowBlur:0,shadow:null},l={translate:null,scale:null,rotate:null,matrix:null,hidden:false},m={clone:function(){return e.extend(true,{},this)},hide:function(){this.itemOptions.hidden=true;return this},show:function(){this.itemOptions.hidden=false;return this},changeMatrix:function(a,b,c,d,f,g){b={m11:1,m12:0,
dx:0,m21:0,m22:1,dy:0};if(this.itemOptions.matrix!==null)b=this.itemOptions.matrix;this.itemOptions.matrix={m11:b.m11*a+b.m12*c,m12:b.m11*c+b.m12*d,dx:b.m11*f+b.m12*g+b.dx,m21:b.m21*a+b.m22*c,m22:b.m21*c+b.m22*d,dy:b.m21*f+b.m22*g+b.dy};return this},setMatrix:function(a,b,c,d,f,g){this.itemOptions.matrix=a===1&&b===0&&c===0&&d===1&&f===0&&g===0?null:{m11:a,m12:b,m21:c,m22:d,dx:f,dy:g};return this},rotateBy:function(a){if(this.itemOptions!==null)this.itemOptions.rotate+=Math.PI*a/180;else return this.rotate(a);
return this},rotate:function(a){this.itemOptions.rotate=a===0?null:Math.PI*a/180;return this},scaleBy:function(a,b){if(this.itemOptions.scale!==null){this.itemOptions.scale.dx+=a;this.itemOptions.scale.dy+=b}else return this.scale(1+a,1+b);return this},scale:function(a,b){this.itemOptions.scale=a===1&&b===1?null:{dx:a,dy:b};return this},moveBy:function(a,b){if(this.itemOptions.translate!==null){this.itemOptions.translate.x+=a;this.itemOptions.translate.y+=b}else return this.move(a,b);return this},
move:function(a,b){this.itemOptions.translate=a===0&&a===0?null:{x:a,y:b};return this},options:function(a){e.extend(this.drawOptions,a);return this},prepare:function(a,b){var c=a.ctx;c.save();c.globalAlpha=a.options.globalAlpha;c.globalCompositeOperation=a.options.globalCompositeOperation;if(this.itemOptions.hidden!==true){b=b!==undefined?e.extend({},this.drawOptions,b):this.drawOptions;if(b.fill!==null)c.fillStyle=typeof b.fill==="object"?b.fill.draw(c):e.isFunction(b.fill)?b.fill.apply(this,[c]):
b.fill;if(b.stroke!==null){c.strokeStyle=typeof b.stroke==="object"?b.stroke.draw(c):e.isFunction(b.stroke)?b.stroke.apply(this,[c]):b.stroke;c.lineWidth=b.width;c.lineCap=b.lineCap;c.lineJoin=b.lineJoin;c.miterLimit=b.miterLimit}if(b.shadow!==null){c.shadowOffsetX=b.shadowX;c.shadowOffsetY=b.shadowY;c.shadowBlur=b.shadowBlur;c.shadowColor=b.shadow}c.setTransform(1,0,0,1,0,0);if(this.itemOptions.matrix!==undefined&&this.itemOptions.matrix!==null){var d=this.itemOptions.matrix;c.setTransform(d.m11,
d.m12,d.m21,d.m22,d.dx,d.dy)}d=this.center(c);this.itemOptions.translate!==undefined&&this.itemOptions.translate!==null&&c.translate(this.itemOptions.translate.x,this.itemOptions.translate.y);if(this.itemOptions.rotate!==undefined&&this.itemOptions.rotate!==null){c.translate(d.x,d.y);c.rotate(this.itemOptions.rotate);c.translate(-d.x,-d.y)}if(this.itemOptions.scale!==undefined&&this.itemOptions.scale!==null){c.translate(d.x,d.y);c.scale(this.itemOptions.scale.dx,this.itemOptions.scale.dy);c.translate(-d.x,
-d.y)}c.beginPath();return b}},finalize:function(a,b){var c=a.ctx;b.stroke!==null&&c.stroke();b.fill!==null&&c.fill();c.restore()}};e.Circle=function(a,b,c){this.drawOptions=e.extend({},k);this.itemOptions=e.extend({},l);this.radius=c;this.move(a,b)};e.extend(e.Circle.prototype,m,{center:function(){return{x:0,y:0}},draw:function(a,b){var c=a.ctx;b=this.prepare(a,b);c.moveTo(this.radius,0);c.arc(0,0,this.radius,0,Math.PI*2,false);c.closePath();this.finalize(a,b)}});e.Rect=function(a,b,c,d,f){this.drawOptions=
e.extend({},k);this.itemOptions=e.extend({},l);this.rect={w:c,h:d};if(f!==undefined)this.rect.r=f;this.move(a,b)};e.extend(e.Rect.prototype,m,{center:function(){return{x:this.rect.w/2,y:this.rect.h/2}},height:function(){return this.rect.h},width:function(){return this.rect.w},draw:function(a,b){var c=a.ctx;b=this.prepare(a,b);if(this.rect.r!==undefined){c.moveTo(this.rect.r,0);c.arcTo(this.rect.w,0,this.rect.w,this.rect.r,this.rect.r);c.arcTo(this.rect.w,this.rect.h,this.rect.r,this.rect.h,this.rect.r);
c.arcTo(0,this.rect.h,0,this.rect.r,this.rect.r);c.arcTo(0,0,this.rect.r,0,this.rect.r)}else c.rect(0,0,this.rect.w,this.rect.h);c.closePath();this.finalize(a,b)}});e.Path=function(a,b){this.drawOptions=e.extend({},k);this.itemOptions=e.extend({},l);this.isClosed=false;this.offset={x:a||0,y:b||0};this.pointStack=[{type:"start"}];this.move(a,b)};e.extend(e.Path.prototype,m,{pointStack:[],line:function(a,b){this.pointStack.push({type:"point",x:a-this.offset.x,y:b-this.offset.y});return this},to:function(a,
b){return this.line(a,b)},close:function(){this.isClosed=true;return this},quadraticCurve:function(a,b,c,d){this.pointStack.push({type:"quadratic",x:a-this.offset.x,y:b-this.offset.y,cx:c-this.offset.x,cy:d-this.offset.y});return this},bezierCurve:function(a,b,c,d,f,g){this.pointStack.push({type:"bezier",x:a-this.offset.x,y:b-this.offset.y,c1x:c-this.offset.x,c1y:d-this.offset.y,c2x:f-this.offset.x,c2y:g-this.offset.y});return this},center:function(){for(var a={i:0,x:0,y:0},b=0;b<this.pointStack.length;b++){var c=
this.pointStack[b];switch(c.type){case "point":a.i++;a.x+=c.x;a.y+=c.y;break;case "quadratic":a.i+=2;a.x+=c.x+c.cx;a.y+=c.y+c.cy;break;case "bezier":a.i+=3;a.x+=c.x+c.c1x+c.c2x;a.y+=c.y+c.c1y+c.c2y}}return{x:a.x/a.i,y:a.y/a.i}},draw:function(a,b){var c=a.ctx;b=this.prepare(a,b);for(i in this.pointStack){var d=this.pointStack[i];switch(d.type){case "start":c.moveTo(0,0);break;case "point":c.lineTo(d.x,d.y);break;case "quadratic":c.quadraticCurveTo(d.cx,d.cy,d.x,d.y);break;case "bezier":c.bezierCurveTo(d.c1x,
d.c1y,d.c2x,d.c2y,d.x,d.y)}}this.isClosed&&c.closePath();this.finalize(a,b)}});e.Text=function(a,b,c){this.drawOptions=e.extend({},k);this.itemOptions=e.extend({},l);this.move(a,b);this.t=c};e.extend(e.Text.prototype,m,{append:function(a){this.t+=""+a;return this},prepend:function(a){this.t=""+a+this.t;return this},text:function(a){this.t=""+a;return this},center:function(a){a.save();a.font=this.drawOptions.font;a.textAlign=this.drawOptions.textAlign;var b=a.measureText(this.t);a.restore();return{x:b.width/
2,y:0}},draw:function(a,b){var c=a.ctx;b=this.prepare(a,b);c.font=b.font;b.stroke!==null&&c.strokeText(this.t,0,0);b.fill!==null&&c.fillText(this.t,0,0);c.closePath();this.finalize(a,b)}});e.Polygon=function(a,b,c,d){this.drawOptions=e.extend({},k);this.itemOptions=e.extend({},l);this.pointStack=[];this.move(a,b);this.setPoints(c,d)};e.extend(e.Polygon.prototype,m,{center:function(){return{x:0,y:0}},setPoints:function(a,b){this.pointStack=[];for(var c=Math.PI*2/a,d=0;d<a;d++)this.pointStack.push({x:b*
Math.cos(d*c),y:b*Math.sin(d*c)});return this},draw:function(a,b){var c=a.ctx;b=this.prepare(a,b);for(i in this.pointStack){var d=this.pointStack[i];c.lineTo(d.x,d.y)}c.closePath();this.finalize(a,b)}});e.CircleSegment=function(a,b,c,d){this.drawOptions=e.extend({},k);this.itemOptions=e.extend({},l);this.p={radius:c,angle:d};this.isClosed=false;this.move(a,b)};e.extend(e.CircleSegment.prototype,m,{center:function(){return{x:0,y:0}},close:function(){this.isClosed=true;return this},draw:function(a,
b){var c=a.ctx;b=this.prepare(a,b);c.moveTo(this.p.radius,0);c.arc(0,0,this.p.radius,0,this.p.angle%360*(Math.PI/180),false);this.isClosed&&c.closePath();this.finalize(a,b)}});e.CircleSector=function(a,b,c,d){this.drawOptions=e.extend({},k);this.itemOptions=e.extend({},l);this.p={radius:c,angle:d};this.move(a,b)};e.extend(e.CircleSector.prototype,m,{center:function(){return{x:0,y:0}},draw:function(a,b){var c=a.ctx;b=this.prepare(a,b);c.moveTo(0,0);c.lineTo(this.p.radius,0);c.arc(0,0,this.p.radius,
0,this.p.angle%360*(Math.PI/180),false);c.closePath();this.finalize(a,b)}});e.Ease={quadIn:function(a,b,c){b/=c;return 2*b*a/c},quadOut:function(a,b,c){b/=c;return-2*(b-1)*a/c},quadInOut:function(a,b,c){b/=c/2;if(b<1)return 2*b*a/c;b--;return-2*(b-1)*a/c},expIn:function(a,b,c,d){d=d||3;b/=c;return d*Math.pow(b,d-1)*a/c},expOut:function(a,b,c,d){return this.expIn(a,c-b,c,d)},expInOut:function(a,b,c,d){b/=c/2;if(b<1)return this.expIn(a,b*c,c,d);b--;return this.expOut(a,b*c,c,d)},backIn:function(a,b,
c,d){d=d||1.70158;b/=c;return b*(3*d*b+3*b-2*d)*a/c},backOut:function(a,b,c,d){d=d||1.70158;b/=c;b-=1;return b*(3*d*b+3*b+2*d)*a/c},backInOut:function(a,b,c,d){d=d||2.5949095;b/=c/2;if(b<1)return b*(3*d*b+3*b-2*d)*a/c;b-=2;return b*(3*d*b+3*b+2*d)*a/c},bounceIn:function(a,b,c){return this.bounceOut(a,c-b,c)},bounceOut:function(a,b,c){b/=c;return b<1/2.75?15.125*b*a/c:b<2/2.75?15.125*(b-1.5/2.75)*a/c:b<2.5/2.75?15.125*(b-2.25/2.75)*a/c:15.125*(b-2.625/2.75)*a/c},bounceInOut:function(a,b,c){if(b<c/
2)return this.bounceIn(a,b*2,c);return this.bounceOut(a,b*2-c,c)},elasticIn:function(a,b,c,d){b/=c;d=d||3;var f=Math.PI;d=1/(d+0.25);return a/c*(2/9)*Math.pow(b,3.5)*Math.sin(b*2*f/d)+a/c*Math.pow(b,4.5)*Math.cos(b*2*f/d)*(2*f/d)},elasticOut:function(a,b,c,d){return this.elasticIn(a,c-b,c,d)},elasticInOut:function(a,b,c,d){if(b<c/2)return this.elasticIn(a,b*2,c,d);return this.elasticOut(a,b*2-c,c,d)}}})();
